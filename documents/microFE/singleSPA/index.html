<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>概念 | 何遇的博客</title>
    <meta name="description" content="何其有幸，今生相遇">
    
    
    <link rel="preload" href="/assets/css/0.styles.164a5025.css" as="style"><link rel="preload" href="/assets/js/app.f2f5fd5f.js" as="script"><link rel="preload" href="/assets/js/2.059a2ac4.js" as="script"><link rel="preload" href="/assets/js/8.1457e148.js" as="script"><link rel="prefetch" href="/assets/js/10.fa16bb28.js"><link rel="prefetch" href="/assets/js/11.6172da64.js"><link rel="prefetch" href="/assets/js/12.2c7eb12e.js"><link rel="prefetch" href="/assets/js/13.834e2568.js"><link rel="prefetch" href="/assets/js/14.c8797915.js"><link rel="prefetch" href="/assets/js/15.d3621ddf.js"><link rel="prefetch" href="/assets/js/16.47cfa1ca.js"><link rel="prefetch" href="/assets/js/17.ca4f535c.js"><link rel="prefetch" href="/assets/js/18.5969456f.js"><link rel="prefetch" href="/assets/js/19.36b7a72a.js"><link rel="prefetch" href="/assets/js/20.bfb1c7cb.js"><link rel="prefetch" href="/assets/js/21.8c5c63b7.js"><link rel="prefetch" href="/assets/js/22.8d8b728a.js"><link rel="prefetch" href="/assets/js/23.821e9c31.js"><link rel="prefetch" href="/assets/js/24.1c637c8c.js"><link rel="prefetch" href="/assets/js/25.7371a5af.js"><link rel="prefetch" href="/assets/js/26.76190fc9.js"><link rel="prefetch" href="/assets/js/27.f9da2b6b.js"><link rel="prefetch" href="/assets/js/28.30d1b685.js"><link rel="prefetch" href="/assets/js/29.c4e44820.js"><link rel="prefetch" href="/assets/js/3.b1b2a1a4.js"><link rel="prefetch" href="/assets/js/30.107b3818.js"><link rel="prefetch" href="/assets/js/31.f0cc79df.js"><link rel="prefetch" href="/assets/js/32.fdaf0810.js"><link rel="prefetch" href="/assets/js/33.f0a255f6.js"><link rel="prefetch" href="/assets/js/34.dda00f89.js"><link rel="prefetch" href="/assets/js/4.ca64d643.js"><link rel="prefetch" href="/assets/js/5.902d47f0.js"><link rel="prefetch" href="/assets/js/6.98951b3b.js"><link rel="prefetch" href="/assets/js/7.327910a8.js"><link rel="prefetch" href="/assets/js/9.32b18022.js">
    <link rel="stylesheet" href="/assets/css/0.styles.164a5025.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">何遇的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">git系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitCommit/" class="nav-link">git commit message 规范</a></li><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitBranch/" class="nav-link">git 分支管理</a></li><li class="dropdown-item"><!----> <a href="/documents/git/" class="nav-link">git的基本用法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">single-spa微前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/microFE/singleSPA/" class="nav-link router-link-exact-active router-link-active">single-spa微前端落地</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/grape/" class="nav-link">微前端框架</a></li></ul></div></div><div class="nav-item"><a href="/documents/VisualPageCreation/list/" class="nav-link">可视化页面搭建</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">早读系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/morningRead/codeReview.html" class="nav-link">codeReview</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/javaScriptErrors.html" class="nav-link">js 错误上报</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/sessionCookie.html" class="nav-link">session,cookie和token</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/weixin/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">第三方库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/library/element/" class="nav-link">element-ui自定义主题原理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/summary/2019/" class="nav-link">2019年度总结</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">git系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitCommit/" class="nav-link">git commit message 规范</a></li><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitBranch/" class="nav-link">git 分支管理</a></li><li class="dropdown-item"><!----> <a href="/documents/git/" class="nav-link">git的基本用法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">single-spa微前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/microFE/singleSPA/" class="nav-link router-link-exact-active router-link-active">single-spa微前端落地</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/grape/" class="nav-link">微前端框架</a></li></ul></div></div><div class="nav-item"><a href="/documents/VisualPageCreation/list/" class="nav-link">可视化页面搭建</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">早读系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/morningRead/codeReview.html" class="nav-link">codeReview</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/javaScriptErrors.html" class="nav-link">js 错误上报</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/sessionCookie.html" class="nav-link">session,cookie和token</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/weixin/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">第三方库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/library/element/" class="nav-link">element-ui自定义主题原理</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/summary/2019/" class="nav-link">2019年度总结</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>概念</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documents/microFE/singleSPA/#抽离公共资源" class="sidebar-link">抽离公共资源</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#设置项目打包格式" class="sidebar-link">设置项目打包格式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#注册子项目" class="sidebar-link">注册子项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/microFE/singleSPA/#各子个项目的配置" class="sidebar-link">各子个项目的配置</a></li><li class="sidebar-sub-header"><a href="/documents/microFE/singleSPA/#hydesign-grape" class="sidebar-link">@hydesign/grape</a></li></ul></li><li><a href="/documents/microFE/singleSPA/#给子项目的入口js加标识" class="sidebar-link">给子项目的入口js加标识</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#配置跨域访问" class="sidebar-link">配置跨域访问</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#资源的访问路径" class="sidebar-link">资源的访问路径</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#各个应用间进行通信" class="sidebar-link">各个应用间进行通信</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#隔离css样式" class="sidebar-link">隔离css样式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#独立运行" class="sidebar-link">独立运行</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/microFE/singleSPA/#参考文章" class="sidebar-link">参考文章</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h1> <p>微前端的概念是从后端的微服务的迁移过来的。将 Web 应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立运行、独立开发、独立部署。</p> <p>微前端只在前后端分离的单页应用中讨论才有意义。单页应用的核心是：在特定的时刻将一段由js运行生成的html代码片段插入到一个特定的位置。微前端项目并没有改变这个核心。微前端的项目与单体项目的差别是：生成html片段的js代码可能位于不同的域名下，所以各个资源的路径最好不要使用相对路径。</p> <p>微前端项目是由多个子项目组成的，所以需要在微前端项目中声明这个项目是由哪些子项目组成的，这个步骤称为子项目注册。子项目注册做的事情是：给这个项目命名，指定这个项目在什么情况下装载在html文档中，在什么情况从html文档中卸载,所以就会涉及到生命周期的钩子函数。</p> <h1 id="项目结构图"><a href="#项目结构图" aria-hidden="true" class="header-anchor">#</a> 项目结构图</h1> <p><img src="/assets/img/project-construction.6eb199fc.png" alt="基于single-spa的vue微前端项目结构"></p> <h1 id="在线访问地址"><a href="#在线访问地址" aria-hidden="true" class="header-anchor">#</a> 在线访问地址</h1> <p><a href="http://microfrontend.heyudesign.cn" target="_blank" rel="noopener noreferrer">在线访问地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="需要解决的问题"><a href="#需要解决的问题" aria-hidden="true" class="header-anchor">#</a> 需要解决的问题</h1> <ol><li>子项目的注册、异步加载和生命周期管理；</li> <li>子项目之间、主从之间的消息机制；</li> <li>子项目之间的安全隔离措施；</li> <li>子项目的框架无关、版本无关；</li> <li>子项目之间、主从之间的公共依赖的库、业务逻辑(utils)以及版本怎么管理；</li> <li>子项目独立调试、和主应用联调的方式；</li> <li>发布</li></ol> <h1 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> demo</h1> <p><a href="https://github.com/QxQstar/single-spa-vue" target="_blank" rel="noopener noreferrer">single-spa微前端方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="实现"><a href="#实现" aria-hidden="true" class="header-anchor">#</a> 实现</h1> <blockquote><p>补充：在这个 demo 中是使用 webpack 打包项目</p></blockquote> <h3 id="给各个应用注册生命周期函数"><a href="#给各个应用注册生命周期函数" aria-hidden="true" class="header-anchor">#</a> 给各个应用注册生命周期函数</h3> <blockquote><p>补充： 在这个 demo 中子项目都是 vue 项目</p></blockquote> <p>安装single-spa-vue</p> <div class="language-cli extra-class"><pre class="language-text"><code>vue add single-spa

// 或者

npm install --save single-spa-vue
</code></pre></div><p>改写入口文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./store/base'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> singleSpaVue <span class="token keyword">from</span> <span class="token string">'single-spa-vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> elementUI <span class="token keyword">from</span> <span class="token string">'element-ui'</span><span class="token punctuation">;</span>
vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>elementUI<span class="token punctuation">)</span>
vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vueLifecycles <span class="token operator">=</span> <span class="token function">singleSpaVue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  Vue<span class="token punctuation">:</span>vue<span class="token punctuation">,</span>
  appOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    el<span class="token punctuation">:</span><span class="token string">'#main'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span>
    router<span class="token punctuation">,</span>
    store
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> bootstrap <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>bootstrap<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> mount <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>mount<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> unmount <span class="token operator">=</span> vueLifecycles<span class="token punctuation">.</span>unmount<span class="token punctuation">;</span>
</code></pre></div><h2 id="抽离公共资源"><a href="#抽离公共资源" aria-hidden="true" class="header-anchor">#</a> 抽离公共资源</h2> <p>配置<code>webpack</code>的 externals 字段使<code>webpack</code>在打包的时候不打包公共库如(vue, vue-router, 私有 npm 包等),如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    externals<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'vue'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'vue-router'</span><span class="token punctuation">:</span><span class="token string">'vueRouter'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'element-ui'</span><span class="token punctuation">:</span><span class="token string">'elementUI'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="设置项目打包格式"><a href="#设置项目打包格式" aria-hidden="true" class="header-anchor">#</a> 设置项目打包格式</h2> <div class="language- extra-class"><pre class="language-text"><code>output: {
    ...
    libraryTarget: 'umd',
    library: xxx,
}
</code></pre></div><h2 id="注册子项目"><a href="#注册子项目" aria-hidden="true" class="header-anchor">#</a> 注册子项目</h2> <h3 id="各子个项目的配置"><a href="#各子个项目的配置" aria-hidden="true" class="header-anchor">#</a> 各子个项目的配置</h3> <div class="language- extra-class"><pre class="language-text"><code>{
        name:'main-project',
        base:true,
        projectIndex:'http://localhost:9100',
    },
    {
        name:'customers',
        base:false,
        path:'#/customers',
        domID:'main',
        projectIndex:'http://localhost:5100',
    },
    {
        name:'goods',
        base:false,
        path:'#/goods',
        domID:'main',
        projectIndex:'http://localhost:9010',
    }
</code></pre></div><h3 id="hydesign-grape"><a href="#hydesign-grape" aria-hidden="true" class="header-anchor">#</a> @hydesign/grape</h3> <p>使用<a href="https://github.com/QxQstar/grape" target="_blank" rel="noopener noreferrer">@hydesign/grape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>完成子项目的注册，异步加载和生命周期管理，并且子项目的框架无关，版本无关。<a href="https://github.com/QxQstar/grape" target="_blank" rel="noopener noreferrer">@hydesign/grape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>与<code>webpack</code>的 externals 配合使用，能够抽离出项目中不想打包的库，并且在项目运行当使用到这个库的时候在动态加载。</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">import</span> Grape <span class="token keyword">from</span> <span class="token string">'@hydesign/grape'</span><span class="token punctuation">;</span>

 <span class="token keyword">new</span> <span class="token class-name">Grape</span><span class="token punctuation">(</span>appsConf<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setImportMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token string">&quot;vue&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;vueRouter&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://cdn.jsdelivr.net/npm/vue-router@3.0.7/dist/vue-router.min.js&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;elementUI&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/element-ui@2.12.0/lib/index.js&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;Vuex&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/vuex@3.1.1/dist/vuex.min.js&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;axios&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/axios@0.19.0/dist/axios.min.js&quot;</span><span class="token punctuation">,</span>
                <span class="token string">&quot;hytools&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;https://cdn.jsdelivr.net/npm/hytools@1.2.0/dist/index.js&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="给子项目的入口js加标识"><a href="#给子项目的入口js加标识" aria-hidden="true" class="header-anchor">#</a> 给子项目的入口js加标识</h2> <p>经过<code>webpack</code>打包之后一个项目在 index.html 中插入的 js 脚本可能不只一个，所以在为了确保<a href="https://github.com/QxQstar/grape" target="_blank" rel="noopener noreferrer">@hydesign/grape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>能够正确的从项目访问入口中解析要入口js，给入口 js 文件加上一个自定义属性</p> <div class="language- extra-class"><pre class="language-text"><code>const ScriptExtHtmlWebpackPlugin = require('script-ext-html-webpack-plugin')
plugins:[
    ...
    new ScriptExtHtmlWebpackPlugin({
      custom: {
        test: /app.*\.js$/,
        attribute: 'entry',
        value: true
      }
    })
  ]
</code></pre></div><h2 id="配置跨域访问"><a href="#配置跨域访问" aria-hidden="true" class="header-anchor">#</a> 配置跨域访问</h2> <div class="language-cli extra-class"><pre class="language-text"><code>    devServer:{
        ...
        headers: {
            &quot;Access-Control-Allow-Origin&quot;: &quot;*&quot;,
        },
    },
</code></pre></div><p>由于子项目的资源需要在入口项目中访问，所以需要在子项目中配置跨域访问</p> <h2 id="资源的访问路径"><a href="#资源的访问路径" aria-hidden="true" class="header-anchor">#</a> 资源的访问路径</h2> <p>由于子项目的资源是在入口项目(入口项目和子项目在不同的域)中访问，所以需要将子项目的 publicPath 设置为完整的路径（即：包括协议和域名），这样才能保证子项目的资源能够正确加载。<a href="https://www.webpackjs.com/configuration/output/#output-publicpath" target="_blank" rel="noopener noreferrer">output.publicPath<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="各个应用间进行通信"><a href="#各个应用间进行通信" aria-hidden="true" class="header-anchor">#</a> 各个应用间进行通信</h2> <p>使用浏览器自定义事件来实现各个应用间的通讯</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// customers</span>
window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'logout'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// main-project</span>
 window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'logout'</span><span class="token punctuation">,</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意：各个应用之间应该尽可能少的进行通信，如果两个应用之间频繁的进行通信，那么它们两个应该合并成一个</p></blockquote> <h2 id="隔离css样式"><a href="#隔离css样式" aria-hidden="true" class="header-anchor">#</a> 隔离css样式</h2> <p>使用<code>webpack</code>，<code>postcss</code>在构建阶段为业务的所有 CSS 都加上自己的作用域</p> <div class="language- extra-class"><pre class="language-text"><code>postcss:{
    plugins:[require('postcss-plugin-namespace')('.main-project',{ ignore: [ '*'] })]
}
</code></pre></div><h2 id="独立运行"><a href="#独立运行" aria-hidden="true" class="header-anchor">#</a> 独立运行</h2> <p>使用 cross-env 设置环境变量，在入口js文件中访问环境变量 process.env.VUE_APP_SINGLERUN 的值决定是否new 一个vue根实例</p> <h2 id="参考文章"><a href="#参考文章" aria-hidden="true" class="header-anchor">#</a> 参考文章</h2> <ul><li><a href="https://single-spa.js.org/" target="_blank" rel="noopener noreferrer">single-spa<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/QxQstar/grape" target="_blank" rel="noopener noreferrer">@hydesign/grape<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/phodal/microfrontends" target="_blank" rel="noopener noreferrer">微前端那些事儿<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5d7f702ce51d4561f777e258" target="_blank" rel="noopener noreferrer">每日优鲜供应链前端团队微前端改造<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000019957162" target="_blank" rel="noopener noreferrer">微前端项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/s/x2N-Y5xZV-XbrqxDT_wLKA" target="_blank" rel="noopener noreferrer">网易严选企业级微前端解决方案与落地实践<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f2f5fd5f.js" defer></script><script src="/assets/js/2.059a2ac4.js" defer></script><script src="/assets/js/8.1457e148.js" defer></script>
  </body>
</html>
