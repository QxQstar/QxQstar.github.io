<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue 源码解读 | 何遇的博客</title>
    <meta name="description" content="何其有幸，今生相遇">
    
    
    <link rel="preload" href="/assets/css/0.styles.164a5025.css" as="style"><link rel="preload" href="/assets/js/app.eaeb3b5e.js" as="script"><link rel="preload" href="/assets/js/2.264b4215.js" as="script"><link rel="preload" href="/assets/js/5.6f0ef342.js" as="script"><link rel="prefetch" href="/assets/js/10.9d57267d.js"><link rel="prefetch" href="/assets/js/11.76c1e5ba.js"><link rel="prefetch" href="/assets/js/12.f8bb5e59.js"><link rel="prefetch" href="/assets/js/13.5f881e9f.js"><link rel="prefetch" href="/assets/js/14.2576e6e5.js"><link rel="prefetch" href="/assets/js/15.fea858b5.js"><link rel="prefetch" href="/assets/js/16.10d6e080.js"><link rel="prefetch" href="/assets/js/17.e2dcf138.js"><link rel="prefetch" href="/assets/js/18.576ca418.js"><link rel="prefetch" href="/assets/js/19.b379f2a1.js"><link rel="prefetch" href="/assets/js/20.2e6743da.js"><link rel="prefetch" href="/assets/js/21.6ef84570.js"><link rel="prefetch" href="/assets/js/22.26445edb.js"><link rel="prefetch" href="/assets/js/23.84c34c04.js"><link rel="prefetch" href="/assets/js/24.2f62628f.js"><link rel="prefetch" href="/assets/js/25.4870ce4e.js"><link rel="prefetch" href="/assets/js/26.bd6fedd8.js"><link rel="prefetch" href="/assets/js/27.722507ec.js"><link rel="prefetch" href="/assets/js/28.ecc3027a.js"><link rel="prefetch" href="/assets/js/29.be154357.js"><link rel="prefetch" href="/assets/js/3.3ac51e40.js"><link rel="prefetch" href="/assets/js/30.8c0b4288.js"><link rel="prefetch" href="/assets/js/31.fc67d08f.js"><link rel="prefetch" href="/assets/js/32.b05b075f.js"><link rel="prefetch" href="/assets/js/33.0e637004.js"><link rel="prefetch" href="/assets/js/34.f3f8e3aa.js"><link rel="prefetch" href="/assets/js/35.5e768e26.js"><link rel="prefetch" href="/assets/js/36.8bff1b35.js"><link rel="prefetch" href="/assets/js/4.60f39b1e.js"><link rel="prefetch" href="/assets/js/6.fc5773e2.js"><link rel="prefetch" href="/assets/js/7.0a444aa5.js"><link rel="prefetch" href="/assets/js/8.6e3cb9aa.js"><link rel="prefetch" href="/assets/js/9.d6f58934.js">
    <link rel="stylesheet" href="/assets/css/0.styles.164a5025.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">何遇的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">git系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitCommit/" class="nav-link">git commit message 规范</a></li><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitBranch/" class="nav-link">git 分支管理</a></li><li class="dropdown-item"><!----> <a href="/documents/git/" class="nav-link">git的基本用法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">single-spa微前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/microFE/singleSPA/" class="nav-link">single-spa微前端落地</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/grape/" class="nav-link">微前端框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">早读系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/morningRead/codeReview.html" class="nav-link">codeReview</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/javaScriptErrors.html" class="nav-link">js 错误上报</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/sessionCookie.html" class="nav-link">session,cookie和token</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/weixin/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">第三方库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/library/element/" class="nav-link">element-ui自定义主题原理</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue/" class="nav-link router-link-exact-active router-link-active"> Vue 源码解读之 Vue 实例创建与挂载流程 </a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-router/" class="nav-link">VueRouter 源码解读</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vuex/" class="nav-link">Vuex 源码解读</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-cli 3.x/" class="nav-link">VueCli 3.x 工具介绍</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/summary/2019/" class="nav-link">2019年度总结</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">git系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitCommit/" class="nav-link">git commit message 规范</a></li><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitBranch/" class="nav-link">git 分支管理</a></li><li class="dropdown-item"><!----> <a href="/documents/git/" class="nav-link">git的基本用法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">single-spa微前端系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/microFE/singleSPA/" class="nav-link">single-spa微前端落地</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/grape/" class="nav-link">微前端框架</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">早读系列</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/morningRead/codeReview.html" class="nav-link">codeReview</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/javaScriptErrors.html" class="nav-link">js 错误上报</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/sessionCookie.html" class="nav-link">session,cookie和token</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/weixin/" class="nav-link">微信小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">第三方库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/library/element/" class="nav-link">element-ui自定义主题原理</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue/" class="nav-link router-link-exact-active router-link-active"> Vue 源码解读之 Vue 实例创建与挂载流程 </a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-router/" class="nav-link">VueRouter 源码解读</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vuex/" class="nav-link">Vuex 源码解读</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-cli 3.x/" class="nav-link">VueCli 3.x 工具介绍</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">总结</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/summary/2019/" class="nav-link">2019年度总结</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue 源码解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documents/library/vue/#flow" class="sidebar-link">flow</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#目录结构" class="sidebar-link">目录结构</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#构建" class="sidebar-link">构建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/library/vue/#runtime-only-vs-runtime-compiler" class="sidebar-link">runtime-only vs runtime+compiler</a></li></ul></li><li><a href="/documents/library/vue/#在引入-vue-时" class="sidebar-link">在引入 Vue 时</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#new-vue" class="sidebar-link">new Vue</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#vue-实例创建与挂载" class="sidebar-link">Vue 实例创建与挂载</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#render-方法" class="sidebar-link">render 方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/library/vue/#传给-render-的第一个参数是字符串" class="sidebar-link">传给 render 的第一个参数是字符串</a></li><li class="sidebar-sub-header"><a href="/documents/library/vue/#传给-render-的第一个参数是组件" class="sidebar-link">传给 render 的第一个参数是组件</a></li></ul></li><li><a href="/documents/library/vue/#update" class="sidebar-link">_update</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#patch" class="sidebar-link">patch</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#new-vue-的过程" class="sidebar-link">new Vue 的过程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#合并配置" class="sidebar-link">合并配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/library/vue/#new-vue-时合并配置" class="sidebar-link">new Vue 时合并配置</a></li><li class="sidebar-sub-header"><a href="/documents/library/vue/#创建组件时合并配置" class="sidebar-link">创建组件时合并配置</a></li></ul></li><li><a href="/documents/library/vue/#生命周期" class="sidebar-link">生命周期</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/documents/library/vue/#组件的注册" class="sidebar-link">组件的注册</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-源码解读"><a href="#vue-源码解读" aria-hidden="true" class="header-anchor">#</a> vue 源码解读</h1> <h2 id="flow"><a href="#flow" aria-hidden="true" class="header-anchor">#</a> flow</h2> <p>静态类型检查，通过类型推断和类型注释检查类型</p> <p>在 vue 源码的 flow 目录中定义了 vue 中用到的自定义类型</p> <h2 id="目录结构"><a href="#目录结构" aria-hidden="true" class="header-anchor">#</a> 目录结构</h2> <p>在 vue 的源码中，作者将功能模块拆分的非常的细，相关的逻辑放在一个单独的目录中维护，将复用的逻辑也抽成一个单独的目录。</p> <h2 id="构建"><a href="#构建" aria-hidden="true" class="header-anchor">#</a> 构建</h2> <p>使用 rollup 构建，rollup 只处理 js 代码，它比 webpack 更轻量</p> <h3 id="runtime-only-vs-runtime-compiler"><a href="#runtime-only-vs-runtime-compiler" aria-hidden="true" class="header-anchor">#</a> runtime-only vs runtime+compiler</h3> <p>runtime-only 版本的 vue,会在 webpack 打包的过程中将 .vue 文件编译成 js 代码。这样打包出的项目代码会小很多并且性能也更好。</p> <p>runtime+compiler 版本的 vue,是在项目运行的时候去编译 vue 的 template 编译成 render. 项目代码更多并且性能更差。在定义 vue 组件时使用的 template 属性就要使用 runtime+compiler 版本</p> <h2 id="在引入-vue-时"><a href="#在引入-vue-时" aria-hidden="true" class="header-anchor">#</a> 在引入 Vue 时</h2> <p>在引入 Vue 时(即 import vue form Vue)，就会在 vue 原型和 vue 构造函数上挂载一些方法</p> <h2 id="new-vue"><a href="#new-vue" aria-hidden="true" class="header-anchor">#</a> new Vue</h2> <p>在 new Vue 时会设置 vue 实例的父子关系，给 data, props, methods 设置代理，初始化 injections,初始化 provide等</p> <h2 id="vue-实例创建与挂载"><a href="#vue-实例创建与挂载" aria-hidden="true" class="header-anchor">#</a> Vue 实例创建与挂载</h2> <p><img src="/assets/img/newVueFlow.fbedb6a5.jpg" alt="runtime + compiler版本 vue 实例挂载流程图"></p> <h2 id="render-方法"><a href="#render-方法" aria-hidden="true" class="header-anchor">#</a> render 方法</h2> <p>将 $createElement 作为 render 的第一个参数，调用 $createElement 返回一个 vnode</p> <h3 id="传给-render-的第一个参数是字符串"><a href="#传给-render-的第一个参数是字符串" aria-hidden="true" class="header-anchor">#</a> 传给 render 的第一个参数是字符串</h3> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>render('div',...)
</code></pre></div><p>调用 new VNode 创建 vnode</p> <h3 id="传给-render-的第一个参数是组件"><a href="#传给-render-的第一个参数是组件" aria-hidden="true" class="header-anchor">#</a> 传给 render 的第一个参数是组件</h3> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>render(APP)
</code></pre></div><p>给组件添加上 Vue 的方法，例如：extend,mixin,use,component 等， 让组件的原型指向 Vue 的原型，将组件的 options 与 Vue 的 options 合并，设置 hooks，最后返回 vnode</p> <p><img src="/assets/img/vueRender.e17706df.jpg" alt="render 过程"></p> <h2 id="update"><a href="#update" aria-hidden="true" class="header-anchor">#</a> _update</h2> <p>在初始化渲染和数据更新都会调用_update,在 _update 中会调用 patch</p> <h2 id="patch"><a href="#patch" aria-hidden="true" class="header-anchor">#</a> patch</h2> <p>在初始化渲染时调用 patch 方法的作用是创建 DOM 节点，并且将子节点插入到父节点中，最后再将生成的 DOM 树插入到 body 中。</p> <p>组件创建是一个深度遍历</p> <h2 id="new-vue-的过程"><a href="#new-vue-的过程" aria-hidden="true" class="header-anchor">#</a> new Vue 的过程</h2> <p><img src="/assets/img/new-vue.9f257f78.png" alt="new Vue 流程"></p> <h2 id="合并配置"><a href="#合并配置" aria-hidden="true" class="header-anchor">#</a> 合并配置</h2> <p>合并配置发生在两个时候，一个时候是 new Vue 时，另一个时候是在 render 创建组件的过程中</p> <h3 id="new-vue-时合并配置"><a href="#new-vue-时合并配置" aria-hidden="true" class="header-anchor">#</a> new Vue 时合并配置</h3> <div class="language-js extra-class"><pre class="language-js"><code>vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
        <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span>
        options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
</code></pre></div><p>会将 vm.constructor 上的配置合并到 vm,所以在 vm 上能够访问到 vm.constructor 上的 filter, directive 等</p> <h3 id="创建组件时合并配置"><a href="#创建组件时合并配置" aria-hidden="true" class="header-anchor">#</a> 创建组件时合并配置</h3> <p>由于组件的构造函数是通过 Vue.extend 继承自 Vue 的，在组件的构造函数中会将 Vue 上的配置与组件的配置进行合并，所以在组件上可以访问到 Vue 上的配置</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">initInternalComponent</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre></div><h2 id="生命周期"><a href="#生命周期" aria-hidden="true" class="header-anchor">#</a> 生命周期</h2> <p><img src="/assets/img/lifecycle.10067f20.jpg" alt="生命周期流程图"></p> <h2 id="组件的注册"><a href="#组件的注册" aria-hidden="true" class="header-anchor">#</a> 组件的注册</h2> <p>全局注册的组件会被注册到 Vue.options.components 上</p> <p>局部注册的组件会被注册到这个组件的 options.components 上(即：vm.options.components)，并且会将全局注册的组件合并到 vm.options.components，所以可以在任何一个组件中访问到全局注册的组件</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eaeb3b5e.js" defer></script><script src="/assets/js/2.264b4215.js" defer></script><script src="/assets/js/5.6f0ef342.js" defer></script>
  </body>
</html>
