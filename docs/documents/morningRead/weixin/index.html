<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信小程序学习笔记 | 何遇的博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="shortcut icon" href="./logo-small.png">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <meta name="description" content="何其有幸，今生相遇">
    <meta property="og:url" content="/documents/morningRead/weixin/">
    <meta property="og:site_name" content="何遇的博客">
    <meta property="og:title" content="微信小程序学习笔记">
    <meta property="og:description" content="微信小程序学习笔记 基础 概括 开始 注册帐号 在小程序注册页注册自己的小程序帐号，注册完小程序帐号之后就可以登录管理后台得到appid，这个appid在开发小程序时需要用到 开发者工具 在开发者工具下载页面下载微信小程序开发者工具 管理 成员管理 在微信小程序中有两种类型的成员，分别是项目成员，体验成员，体验成员可以使用体验版小程序，项目成员也可以使用体验">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="何遇的博客">
    <meta name="theme-color" content="#46bd87">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.0e880142.css" as="style"><link rel="preload" href="/assets/js/app.9dc39beb.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.ed0c22da.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.63b68437.js" as="script"><link rel="preload" href="/assets/js/page-微信小程序学习笔记.d3722e3c.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.238c3454.js" as="script"><link rel="prefetch" href="/assets/js/79.088897f9.js"><link rel="prefetch" href="/assets/js/layout-Blog.c0f5ebe1.js"><link rel="prefetch" href="/assets/js/layout-Layout.f3e9cb51.js"><link rel="prefetch" href="/assets/js/layout-NotFound.c6135a45.js"><link rel="prefetch" href="/assets/js/layout-Slide.8d881117.js"><link rel="prefetch" href="/assets/js/page--0f1c1344.e12dc4f5.js"><link rel="prefetch" href="/assets/js/page--3beb7a7f.30d8ab2e.js"><link rel="prefetch" href="/assets/js/page--44fe3a71.f6e155de.js"><link rel="prefetch" href="/assets/js/page--49f39a0d.aa670c11.js"><link rel="prefetch" href="/assets/js/page--5298089e.d6dad615.js"><link rel="prefetch" href="/assets/js/page-1100(2020-04-13).d7856142.js"><link rel="prefetch" href="/assets/js/page-2020总结｜何遇-写给2020年的何遇.6e840928.js"><link rel="prefetch" href="/assets/js/page-Class.c3d37334.js"><link rel="prefetch" href="/assets/js/page-CodeReview.b672ed88.js"><link rel="prefetch" href="/assets/js/page-Fastloadtimes.71d927d2.js"><link rel="prefetch" href="/assets/js/page-Home.77dc3f6d.js"><link rel="prefetch" href="/assets/js/page-JavaScriptErrors.b54cac6d.js"><link rel="prefetch" href="/assets/js/page-Promise.e00df7be.js"><link rel="prefetch" href="/assets/js/page-VueCli3x.2abf90e6.js"><link rel="prefetch" href="/assets/js/page-VueCli3x中使用的工具及其作用与用法.dc604b3c.js"><link rel="prefetch" href="/assets/js/page-Web性能优化第一篇.6ecc073f.js"><link rel="prefetch" href="/assets/js/page-asyncawait.562b8874.js"><link rel="prefetch" href="/assets/js/page-babel的编译流程.6a20b91d.js"><link rel="prefetch" href="/assets/js/page-cookie，session和token.e94f432a.js"><link rel="prefetch" href="/assets/js/page-element-ui.5447f70f.js"><link rel="prefetch" href="/assets/js/page-eslint.2aa1f226.js"><link rel="prefetch" href="/assets/js/page-git.b30d9c26.js"><link rel="prefetch" href="/assets/js/page-gitcommitmessage规范.2be002e8.js"><link rel="prefetch" href="/assets/js/page-git分支管理规范.3445fdb9.js"><link rel="prefetch" href="/assets/js/page-git版本管理规范.24a1e744.js"><link rel="prefetch" href="/assets/js/page-grape-cli.e5adb601.js"><link rel="prefetch" href="/assets/js/page-nodeJs文件系统.2d309222.js"><link rel="prefetch" href="/assets/js/page-nodejs被用来做什么样的项目.2b735a7c.js"><link rel="prefetch" href="/assets/js/page-path.e7aa80b8.js"><link rel="prefetch" href="/assets/js/page-react生态中的工具.f061456f.js"><link rel="prefetch" href="/assets/js/page-vue-router源码解读.ae3afc87.js"><link rel="prefetch" href="/assets/js/page-vuecreate创建项目.d8ef241b.js"><link rel="prefetch" href="/assets/js/page-vuex源码解读.7a163842.js"><link rel="prefetch" href="/assets/js/page-vue服务端渲染.7b1526dd.js"><link rel="prefetch" href="/assets/js/page-vue源码解读.2bfc4a99.js"><link rel="prefetch" href="/assets/js/page-webpack.3f8e643b.js"><link rel="prefetch" href="/assets/js/page-《用React开发一个低代码系统》大纲.bbd6b8fb.js"><link rel="prefetch" href="/assets/js/page-什么是低代码无代码技术.953806c5.js"><link rel="prefetch" href="/assets/js/page-优化JS的加载性能之TreeShaking.e33f83f7.js"><link rel="prefetch" href="/assets/js/page-优化你的JS.111d7715.js"><link rel="prefetch" href="/assets/js/page-优化网站中的图片和视频.3dcb7842.js"><link rel="prefetch" href="/assets/js/page-关于低代码的思考.fe691c85.js"><link rel="prefetch" href="/assets/js/page-列表可视化创建入口.702776f4.js"><link rel="prefetch" href="/assets/js/page-列表可视化辅助编程.495c8fc6.js"><link rel="prefetch" href="/assets/js/page-前端基础建设.1b0ea2c3.js"><link rel="prefetch" href="/assets/js/page-前端状态管理的历史回溯与思考.3023eeec.js"><link rel="prefetch" href="/assets/js/page-单元测试库jest.6e649e8c.js"><link rel="prefetch" href="/assets/js/page-图片美化.9e9028c3.js"><link rel="prefetch" href="/assets/js/page-基于single-spa的微前端框架.8a45ad15.js"><link rel="prefetch" href="/assets/js/page-基本信息.2a3d2f7d.js"><link rel="prefetch" href="/assets/js/page-实现微前端的不同方式.a0929054.js"><link rel="prefetch" href="/assets/js/page-微前端在react项目中应用.393aaccf.js"><link rel="prefetch" href="/assets/js/page-手把手带你实现一个MiniReact.82986476.js"><link rel="prefetch" href="/assets/js/page-抽象语法树.3f10c961.js"><link rel="prefetch" href="/assets/js/page-是时候用useMemo,useCallback,React'smemoAPI优化性能了.3831033b.js"><link rel="prefetch" href="/assets/js/page-概念.05c4384f.js"><link rel="prefetch" href="/assets/js/page-深入ReactFiber内部.816b7363.js"><link rel="prefetch" href="/assets/js/page-深入Reactfiber内部.d857f3f4.js"><link rel="prefetch" href="/assets/js/page-深入讲解React中的state和props更新.b1051faf.js"><link rel="prefetch" href="/assets/js/page-用Lerna管理TypeScriptmonorepo.0a93bb6d.js"><link rel="prefetch" href="/assets/js/page-给视频和图片添加特效.4356307c.js"><link rel="prefetch" href="/assets/js/page-记录微信小程序开发遇到的一些坑.7f7ccf67.js"><link rel="prefetch" href="/assets/js/page-详情表单可视化创建入口.182ad8bb.js"><link rel="prefetch" href="/assets/js/page-这是一篇写给初学者的React学习建议.996231c7.js"><link rel="prefetch" href="/assets/js/page-选择正确的图像格式.63e5093c.js"><link rel="prefetch" href="/assets/js/page-页面可视化搭建系统设计思路.f78ad7fc.js"><link rel="prefetch" href="/assets/js/page-颜色、颜色空间以及颜色转换的基础指南.464d9524.js"><link rel="prefetch" href="/assets/js/page-颜色空间.124b5892.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.c1bd63d1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0e880142.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><!----> <!----> <span class="site-name can-hide">何遇的博客</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="git系列" class="dropdown-title"><span class="title"><!---->
        git系列
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/webBasic/gitCommit/" class="nav-link"><!---->
  git commit message 规范
</a></li><li class="dropdown-item"><a href="/documents/webBasic/gitBranch/" class="nav-link"><!---->
  git 分支管理
</a></li><li class="dropdown-item"><a href="/documents/git/" class="nav-link"><!---->
  git的基本用法
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="低代码" class="dropdown-title"><span class="title"><!---->
        低代码
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/lowCode/lowCode.html" class="nav-link"><!---->
  关于低代码的思考
</a></li><li class="dropdown-item"><a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/Promise.html" class="nav-link"><!---->
  基础理论知识 -- Promise
</a></li><li class="dropdown-item"><a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/asyncAwait.html" class="nav-link"><!---->
  基础理论知识 -- async/await
</a></li><li class="dropdown-item"><a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/class.html" class="nav-link"><!---->
  基础理论知识 -- class
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="微前端系列" class="dropdown-title"><span class="title"><!---->
        微前端系列
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/microFE/webComponent/" class="nav-link"><!---->
  webComponent + 微前端
</a></li><li class="dropdown-item"><a href="/documents/microFE/mutilResolve/" class="nav-link"><!---->
  实现微前端不同方式
</a></li><li class="dropdown-item"><a href="/documents/microFE/reactResolve/" class="nav-link"><!---->
  微前端在 react 项目中应用
</a></li><li class="dropdown-item"><a href="/documents/microFE/singleSPA/" class="nav-link"><!---->
  single-spa 微前端落地
</a></li><li class="dropdown-item"><a href="/documents/microFE/grape/" class="nav-link"><!---->
  基于 single-spa 的微前端框架
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="早读系列" class="dropdown-title"><span class="title"><!---->
        早读系列
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/morningRead/codeReview.html" class="nav-link"><!---->
  codeReview
</a></li><li class="dropdown-item"><a href="/documents/morningRead/javaScriptErrors.html" class="nav-link"><!---->
  js 错误上报
</a></li><li class="dropdown-item"><a href="/documents/morningRead/sessionCookie.html" class="nav-link"><!---->
  session,cookie和token
</a></li><li class="dropdown-item"><a href="/documents/morningRead/weixin/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="第三方库" class="dropdown-title"><span class="title"><!---->
        第三方库
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/library/element/" class="nav-link"><!---->
  element-ui自定义主题原理
</a></li><li class="dropdown-item"><a href="/documents/library/vue/" class="nav-link"><!---->
   Vue 源码解读之 Vue 实例创建与挂载流程 
</a></li><li class="dropdown-item"><a href="/documents/library/vue-router/" class="nav-link"><!---->
  VueRouter 源码解读
</a></li><li class="dropdown-item"><a href="/documents/library/vuex/" class="nav-link"><!---->
  Vuex 源码解读
</a></li><li class="dropdown-item"><a href="/documents/library/vue-cli 3.x/" class="nav-link"><!---->
  VueCli 3.x 工具介绍
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title"><!---->
        总结
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/documents/summary/2019/" class="nav-link"><!---->
  2019年度总结
</a></li><li class="dropdown-item"><a href="/documents/summary/resumes/2020.html" class="nav-link"><!---->
  个人简历
</a></li><li class="dropdown-item"><a href="/documents/summary/QA/interview.html" class="nav-link"><!---->
  前端知识你问我答
</a></li><li class="dropdown-item"><a href="/documents/VisualPageCreation/" class="nav-link"><!---->
  页面可视化搭建系统设计思路
</a></li><li class="dropdown-item"><a href="/documents/reactHooks/useCallback+UseMemo+MemoApi.html" class="nav-link"><!---->
  是时候用 useMemo,useCallback,React's memo API 优化性能了?
</a></li><li class="dropdown-item"><a href="/documents/analyseReact/" class="nav-link"><!---->
  手把手带你实现一个简易版 React
</a></li><li class="dropdown-item"><a href="/documents/summary/stateManager/" class="nav-link"><!---->
  前端状态管理的历史回溯与思考
</a></li><li class="dropdown-item"><a href="/documents/summary/2020/" class="nav-link"><!---->
  2020 总结｜何遇 - 写给 2020 年的何遇
</a></li><li class="dropdown-item"><a href="/documents/summary/fiber/result.html" class="nav-link"><!---->
  深入学习 React Fiber
</a></li><li class="dropdown-item"><a href="/documents/summary/reactUpdate/" class="nav-link"><!---->
  深入讲解 React 中的 state 和 props 更新
</a></li><li class="dropdown-item"><a href="/documents/visualization/beautify/" class="nav-link"><!---->
  图片美化
</a></li><li class="dropdown-item"><a href="/documents/summary/lernaWithTs/" class="nav-link"><!---->
  用 Lerna 管理 TypeScript monorepo
</a></li><li class="dropdown-item"><a href="/documents/summary/colorSpace/result.html" class="nav-link"><!---->
  颜色空间的基本指南
</a></li><li class="dropdown-item"><a href="/documents/summary/realTimeEffectForVideo/" class="nav-link"><!---->
  给视频和图片添加特效
</a></li><li class="dropdown-item"><a href="/documents/summary/fastLoadTime/result.html" class="nav-link"><!---->
  Web 性能优化第一篇
</a></li><li class="dropdown-item"><a href="/documents/summary/optimizeYourImages/result.html" class="nav-link"><!---->
  优化网站中的图片和视频
</a></li><li class="dropdown-item"><a href="/documents/summary/treeshaking/treeShaking.html" class="nav-link"><!---->
  优化 JS 的加载性能之 Tree Shaking
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="git系列" class="dropdown-title"><span class="title"><!---->
      git系列
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitCommit/" class="nav-link"><!---->
  git commit message 规范
</a></li><li class="dropdown-item"><!----> <a href="/documents/webBasic/gitBranch/" class="nav-link"><!---->
  git 分支管理
</a></li><li class="dropdown-item"><!----> <a href="/documents/git/" class="nav-link"><!---->
  git的基本用法
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="低代码" class="dropdown-title"><span class="title"><!---->
      低代码
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/lowCode/lowCode.html" class="nav-link"><!---->
  关于低代码的思考
</a></li><li class="dropdown-item"><!----> <a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/Promise.html" class="nav-link"><!---->
  基础理论知识 -- Promise
</a></li><li class="dropdown-item"><!----> <a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/asyncAwait.html" class="nav-link"><!---->
  基础理论知识 -- async/await
</a></li><li class="dropdown-item"><!----> <a href="/documents/lowCode/basicTheory/TypeScript/ES6ES7/class.html" class="nav-link"><!---->
  基础理论知识 -- class
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="微前端系列" class="dropdown-title"><span class="title"><!---->
      微前端系列
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/microFE/webComponent/" class="nav-link"><!---->
  webComponent + 微前端
</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/mutilResolve/" class="nav-link"><!---->
  实现微前端不同方式
</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/reactResolve/" class="nav-link"><!---->
  微前端在 react 项目中应用
</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/singleSPA/" class="nav-link"><!---->
  single-spa 微前端落地
</a></li><li class="dropdown-item"><!----> <a href="/documents/microFE/grape/" class="nav-link"><!---->
  基于 single-spa 的微前端框架
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="早读系列" class="dropdown-title"><span class="title"><!---->
      早读系列
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/morningRead/codeReview.html" class="nav-link"><!---->
  codeReview
</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/javaScriptErrors.html" class="nav-link"><!---->
  js 错误上报
</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/sessionCookie.html" class="nav-link"><!---->
  session,cookie和token
</a></li><li class="dropdown-item"><!----> <a href="/documents/morningRead/weixin/" aria-current="page" class="nav-link router-link-exact-active router-link-active active"><!---->
  微信小程序
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="第三方库" class="dropdown-title"><span class="title"><!---->
      第三方库
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/library/element/" class="nav-link"><!---->
  element-ui自定义主题原理
</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue/" class="nav-link"><!---->
   Vue 源码解读之 Vue 实例创建与挂载流程 
</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-router/" class="nav-link"><!---->
  VueRouter 源码解读
</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vuex/" class="nav-link"><!---->
  Vuex 源码解读
</a></li><li class="dropdown-item"><!----> <a href="/documents/library/vue-cli 3.x/" class="nav-link"><!---->
  VueCli 3.x 工具介绍
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="总结" class="dropdown-title"><span class="title"><!---->
      总结
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/documents/summary/2019/" class="nav-link"><!---->
  2019年度总结
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/resumes/2020.html" class="nav-link"><!---->
  个人简历
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/QA/interview.html" class="nav-link"><!---->
  前端知识你问我答
</a></li><li class="dropdown-item"><!----> <a href="/documents/VisualPageCreation/" class="nav-link"><!---->
  页面可视化搭建系统设计思路
</a></li><li class="dropdown-item"><!----> <a href="/documents/reactHooks/useCallback+UseMemo+MemoApi.html" class="nav-link"><!---->
  是时候用 useMemo,useCallback,React's memo API 优化性能了?
</a></li><li class="dropdown-item"><!----> <a href="/documents/analyseReact/" class="nav-link"><!---->
  手把手带你实现一个简易版 React
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/stateManager/" class="nav-link"><!---->
  前端状态管理的历史回溯与思考
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/2020/" class="nav-link"><!---->
  2020 总结｜何遇 - 写给 2020 年的何遇
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/fiber/result.html" class="nav-link"><!---->
  深入学习 React Fiber
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/reactUpdate/" class="nav-link"><!---->
  深入讲解 React 中的 state 和 props 更新
</a></li><li class="dropdown-item"><!----> <a href="/documents/visualization/beautify/" class="nav-link"><!---->
  图片美化
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/lernaWithTs/" class="nav-link"><!---->
  用 Lerna 管理 TypeScript monorepo
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/colorSpace/result.html" class="nav-link"><!---->
  颜色空间的基本指南
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/realTimeEffectForVideo/" class="nav-link"><!---->
  给视频和图片添加特效
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/fastLoadTime/result.html" class="nav-link"><!---->
  Web 性能优化第一篇
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/optimizeYourImages/result.html" class="nav-link"><!---->
  优化网站中的图片和视频
</a></li><li class="dropdown-item"><!----> <a href="/documents/summary/treeshaking/treeShaking.html" class="nav-link"><!---->
  优化 JS 的加载性能之 Tree Shaking
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/QxQstar" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">微信小程序学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documents/morningRead/weixin/#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#概括" class="sidebar-link heading3">概括</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#开始" class="sidebar-link heading3">开始</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#管理" class="sidebar-link heading3">管理</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#发布" class="sidebar-link heading3">发布</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#目录结构" class="sidebar-link heading3">目录结构</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#生命周期" class="sidebar-link heading3">生命周期</a></li></ul></li><li><a href="/documents/morningRead/weixin/#进阶" class="sidebar-link">进阶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#页面路由" class="sidebar-link heading3">页面路由</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#运行机制" class="sidebar-link heading3">运行机制</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#版本更新" class="sidebar-link heading3">版本更新</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#性能优化" class="sidebar-link heading3">性能优化</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#分包加载" class="sidebar-link heading3">分包加载</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#文件系统" class="sidebar-link heading3">文件系统</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#授权" class="sidebar-link heading3">授权</a></li><li class="sidebar-sub-header"><a href="/documents/morningRead/weixin/#低版本兼容" class="sidebar-link heading3">低版本兼容</a></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">微信小程序学习笔记</span></h1> <div class="page-info"><!----> <!----><!----><span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2020-2-11</span></span><!----><!----><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 26 min</span> <meta property="timeRequired" content="PT26M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/documents/morningRead/weixin/#基础" class="anchor-link heading2"><div>基础</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#概括" class="anchor-link heading3"><div>概括</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#开始" class="anchor-link heading3"><div>开始</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#管理" class="anchor-link heading3"><div>管理</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#发布" class="anchor-link heading3"><div>发布</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#目录结构" class="anchor-link heading3"><div>目录结构</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#生命周期" class="anchor-link heading3"><div>生命周期</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#进阶" class="anchor-link heading2"><div>进阶</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#页面路由" class="anchor-link heading3"><div>页面路由</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#运行机制" class="anchor-link heading3"><div>运行机制</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#版本更新" class="anchor-link heading3"><div>版本更新</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#性能优化" class="anchor-link heading3"><div>性能优化</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#分包加载" class="anchor-link heading3"><div>分包加载</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#文件系统" class="anchor-link heading3"><div>文件系统</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#授权" class="anchor-link heading3"><div>授权</div></a></li><li class="anchor"><a href="/documents/morningRead/weixin/#低版本兼容" class="anchor-link heading3"><div>低版本兼容</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="微信小程序学习笔记"><a href="#微信小程序学习笔记" class="header-anchor">#</a> 微信小程序学习笔记</h1> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="概括"><a href="#概括" class="header-anchor">#</a> 概括</h3> <p><img src="/assets/img/brife.1e68da5f.png" alt="概括"></p> <h3 id="开始"><a href="#开始" class="header-anchor">#</a> 开始</h3> <h4 id="注册帐号"><a href="#注册帐号" class="header-anchor">#</a> 注册帐号</h4> <p>在<a href="https://mp.weixin.qq.com/wxopen/waregister?action=step1" target="_blank" rel="noopener noreferrer">小程序注册页<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>注册自己的小程序帐号，注册完小程序帐号之后就可以登录管理后台得到appid，这个appid在开发小程序时需要用到</p> <h4 id="开发者工具"><a href="#开发者工具" class="header-anchor">#</a> 开发者工具</h4> <p>在<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener noreferrer">开发者工具下载页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载微信小程序开发者工具</p> <h3 id="管理"><a href="#管理" class="header-anchor">#</a> 管理</h3> <h4 id="成员管理"><a href="#成员管理" class="header-anchor">#</a> 成员管理</h4> <p>在微信小程序中有两种类型的成员，分别是项目成员，体验成员，体验成员可以使用体验版小程序，项目成员也可以使用体验版小程序，除此之外项目成员可以登录小程序管理后台。项目成员有三种不同的角色：分别是开发者，运营者以及数据分析者，不同的角色登录管理后台能够执行的操作有所不同。欲知详情，前往<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/release.html#%E5%8D%8F%E5%90%8C%E5%B7%A5%E4%BD%9C" target="_blank" rel="noopener noreferrer">微信小程序开发者文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="版本管理"><a href="#版本管理" class="header-anchor">#</a> 版本管理</h4> <p>通常在web前端应用的开发流程中会存在多个版本，比如开发版，测试版，线上版等。微信小程序的开发流程与此类似，不一样的地方是，微信小程序开发流程中多了审核这一个必须的步骤。</p> <ol><li>开发版：开发者在微信小程序开发者工具中进行开发，在任何时刻任何开发者都可以点击开发者工具中的<code>上传</code>按钮上传代码，上传以后就可以在管理后台看到刚提交的代码了。开发版本只保留每人最新的一份上传的代码</li> <li>体验版：选择某个开发版作为体验版，体验版通常是相对稳定的，用于测试人员测试或者产品人员验收。</li> <li>审核中版本：当小程序测试通过之后，将测试通过的版本提交审核，在一段时间内只能有一份代码处于审核中。</li> <li>线上版本：当审核中版本审核通过之后可以发布该版本，发布之后就可以供线上用户使用。</li></ol> <h3 id="发布"><a href="#发布" class="header-anchor">#</a> 发布</h3> <p>一个小程序的开发到发布通常要经历的过程是：开发 -&gt; 上传代码 -&gt; 提交审核 -&gt; 发布。微信小程序有两种发布方式，分别是全量发布以及分阶段发布，分阶段发布又叫做灰度发布。</p> <ol><li>全量发布：当点击发布之后，所有用户访问小程序时都会使用当前最新的发布版本。</li> <li>分阶段发布：分阶段发布是指分不同时间段来控制部分用户使用最新的发布版本。</li></ol> <h3 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h3> <p>使用开发者工具新建一个小程序，新建完成之后会生成一个基本的目录结构，你可以根据自己的需要取改变目录结构。小程序包含一个描述整体程序的 app 和多个描述各自页面的 page。开发者工具生成的项目结构如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    .
    ├── app.js     
    ├── app.json
    ├── app.wxss
    ├── pages                   //页面
    │   ├── index
    │   │   ├── index.js
    │   │   ├── index.json
    │   │   ├── index.wxml
    │   │   └── index.wxss
    │   └── logs
    │       ├── logs.js
    │       ├── logs.json
    │       ├── logs.wxml
    │       └── logs.wxss
    ├── project.config.json  
    ├── sitemap.json         // 小程序页面微信索引配置规则
    └── utils
        └── util.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="主体文件"><a href="#主体文件" class="header-anchor">#</a> 主体文件</h4> <p>微信小程序由三个主体部分组成，分别是app.js,app.json,app.wxss,这个三个文件必须放在项目的根目录</p> <ol><li>app.js:这个文件是每个微信小程序必需的文件，每个小程序都需要在 app.js 中调用 App 方法注册小程序实例,它接受一个 Object 参数，其指定小程序的生命周期回调等。整个小程序只有一个 App 实例。可以通过在js文件中调用 getApp 方法获取App实例。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">/** app.js */</span>
    <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// something</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">/** xxx.js */</span>
    
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol start="2"><li>app.json: 这个是所有小程序都必需的文件，在这个文件中对小程序进行全局配置，例如：配置页面路径，网络超时时间等。在这个文件中使用pages属性必须配置页面路径，pages属性的第一个路径是小程序的首页。查看<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html" target="_blank" rel="noopener noreferrer">所有的全局配置属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code>    <span class="token punctuation">{</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;pages/logs/logs&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;pages/index/index&quot;</span>
        
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;window&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;backgroundTextStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;light&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarBackgroundColor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span> <span class="token string">&quot;WeChat&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;navigationBarTextStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;black&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sitemapLocation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sitemap.json&quot;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li>app.wxss: 定义小程序公共样式，非必需。在这个文件中定义的样式可以应用到所有的页面上。</li></ol> <h4 id="页面文件"><a href="#页面文件" class="header-anchor">#</a> 页面文件</h4> <p>每一个微信小程序页面都有四个与之相关的文件，分别是js，wxss，wxml以及json文件，这四个文件必须在相同的路径中，并且文件名也必须相同。所有的页面都必须在app.json的pages属性中去声明，小程序中新增/减少页面，都需要对 pages 数组进行修改。</p> <ol><li>js:对页面而言这是一个必需的文件，在这个文件中调用 Page 方法注册页面实例，页面的生命周期函数，数据等都做这个文件中定义或声明</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token comment">// something</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>wxml:对页面而言这也是一个必需的文件，在这个文件中声明页面的结构，这个文件与html类似,但是也存在很多不一样的地方，比如标签名字有点不一样。详情请前往<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/code.html#WXML-%E6%A8%A1%E6%9D%BF" target="_blank" rel="noopener noreferrer">WXML 模板介绍<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>wxss:非必需的文件，在这个文件中定义页面的样式，在这个文件书写的样式只对当前页面有效。WXSS 具有 CSS 大部分的特性，小程序在 WXSS 也做了一些扩充和修改。比如小程序新增了rpx这个单位，详情请前往<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxss.html" target="_blank" rel="noopener noreferrer">WXSS 样式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>json:非必需的文件，在json中对本页面的窗口表现进行配置，页面中配置项会覆盖 app.json 的 window 中相同的配置项。详情请前往<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/page.html" target="_blank" rel="noopener noreferrer">页面配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h3 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h3> <h4 id="小程序app的生命周期"><a href="#小程序app的生命周期" class="header-anchor">#</a> 小程序APP的生命周期</h4> <ol><li>onLaunch(Object object):小程序初始化完成时触发，全局只触发一次，当小程序冷启动时才会触发，关于冷启动和热启动见下文。这个生命周期函数接受一个参数，该参数中包含小程序启动时的参数，如路径，query参数等。</li> <li>onShow(Object object):小程序启动或者从前台进入后台时触发，关于小程序和前台和后台见下文。 也可以使用<code>wx.onAppShow</code> 绑定监听,如果既定义了<code>onShow</code>又执行<code>wx.onAppShow(function)</code>,那么两个回调函数都会执行。</li> <li>onHide():小程序从前台进入后台时触发。也可以使用 <code>wx.onAppHide</code> 绑定监听。如果既定义了<code>onHide</code>又执行<code>wx.onAppHide(function)</code>,那么两个回调函数都会执行。</li> <li>onError(String error):小程序发生脚本错误或 API 调用报错时触发。也可以使用 <code>wx.onError</code> 绑定监听。</li> <li>onPageNotFound(Object object): 小程序要打开的页面不存在时触发。也可以使用 <code>wx.onPageNotFound</code> 绑定监听,可以在回调函数中进行页面重定向，但是必须在回调中同步处理</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">onLaunch</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something initial .</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onShow</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something .</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onHide</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onError</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/** 基础库 1.9.90 开始支持 */</span>
  <span class="token function">onPageNotFound</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      <span class="token comment">// Do something </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="页面的生命周期"><a href="#页面的生命周期" class="header-anchor">#</a> 页面的生命周期</h4> <ol><li>onLoad(Object query):页面加载时触发。一个页面只会调用一次，可以在 onLoad 的参数中获取打开当前页面路径中的参数。关于什么情况会导致页面加载请查看<a href="#%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1">页面路由</a>部分</li> <li>onShow():页面显示/切入前台时触发。</li> <li>onReady():页面初次渲染完成时触发。一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互.如果要修改界面内容，如：导航文字，导航背景色等就在onReady之后进行</li> <li>onHide():页面隐藏/切入后台时触发。 如 wx.navigateTo 或底部 tab 切换到其他页面，小程序切入后台等。</li> <li>onUnload():页面卸载时触发。如wx.redirectTo或wx.navigateBack到其他页面时。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do some initialize when page load.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Do something when page show.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page ready.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onHide</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page hide.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onUnload</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page close.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="页面事件处理函数"><a href="#页面事件处理函数" class="header-anchor">#</a> 页面事件处理函数</h4> <ol><li>onPullDownRefresh():监听用户下拉刷新事件。可以调用<code>wx.startPullDownRefresh(Object object)</code>从代码层面开始下拉刷新，效果与用户手动下拉刷新一致。</li></ol> <ul><li><ol><li>要在app.json(window.enablePullDownRefresh)或者页面配置文件(enablePullDownRefresh)中设置允许下拉刷新</li></ol></li> <li><ol start="2"><li>在回调函数中处理完数据刷新之后，要调用 <strong>wx.stopPullDownRefresh</strong>停止页面刷新</li></ol></li></ul> <ol start="2"><li>onReachBottom():监听用户上拉触底事件。可以在app.json和页面配置中设置触发距离</li></ol> <ul><li><ol><li>在触发距离内滑动期间，本事件只会被触发一次。</li></ol></li> <li><ol start="2"><li>要避免触底事件处理程序还没有处理完成，又再一次触发触底事件。</li></ol></li></ul> <ol start="3"><li>onPageScroll(Object object):监听用户滑动页面事件。</li></ol> <ul><li><ol><li>请只在需要的时候才在 page 中定义此方法，不要定义空方法。以减少不必要的事件派发对渲染层-逻辑层通信的影响。</li></ol></li> <li><ol start="2"><li>请避免在 onPageScroll 中过于频繁的执行 setData 等引起逻辑层-渲染层通信的操作。</li></ol></li></ul> <ol start="4"><li>onShareAppMessage(Object object):监听用户点击页面内转发按钮（button 组件 open-type=&quot;share&quot;）或右上角菜单“转发”按钮的行为，并自定义转发内容。此事件处理函数需要 return 一个 Object，用于自定义转发内容。自定义转发内容参数如下</li></ol> <table><thead><tr><th style="text-align:left;">字段</th> <th>说明</th> <th style="text-align:right;">默认值</th></tr></thead> <tbody><tr><td style="text-align:left;">title</td> <td>转发标题</td> <td style="text-align:right;">当前小程序名称</td></tr> <tr><td style="text-align:left;">path</td> <td>转发路径</td> <td style="text-align:right;">当前页面 path ，必须是以 / 开头的完整路径</td></tr> <tr><td style="text-align:left;">imageUrl</td> <td>自定义图片路径，可以是本地文件路径、代码包文件路径或者网络图片路径。支持PNG及JPG。显示图片长宽比是 5:4。如果需要自己用canvas画图，画图完成之后调用wx.canvasToTempFilePath将画布转成图片</td> <td style="text-align:right;">使用默认截图</td></tr></tbody></table> <ul><li><ol><li>只有定义了此事件处理函数，右上角菜单才会显示<code>转发</code>按钮。如果需要在页面中定义转发事件处理函数，但是又不想右上角菜单才会显示<code>转发</code>按钮，可以调用<code>wx.hideShareMenu</code>方法隐藏转发按钮</li></ol></li></ul> <ol start="5"><li>onResize(Object object):小程序屏幕旋转时触发。</li> <li>onTabItemTap(Object object):点击 tab 时触发</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
 <span class="token function-variable function">onPullDownRefresh</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when pull down.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onReachBottom</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page reach bottom.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onShareAppMessage</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return custom share data when user share.</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onPageScroll</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page scroll</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onResize</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something when page resize</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onTabItemTap</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>index<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>pagePath<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="进阶"><a href="#进阶" class="header-anchor">#</a> 进阶</h2> <h3 id="页面路由"><a href="#页面路由" class="header-anchor">#</a> 页面路由</h3> <p>微信小程序以栈的形式维护当前所有的页面,可以使用<code>getCurrentPages()</code>方法获得当前所有的页面栈，在小程序中的页面进行跳转会修改页面栈，也会触发相关页面的生命周期函数。做如下总结，详情请查看小程序开发者文档中的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/route.html" target="_blank" rel="noopener noreferrer">页面路由<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>部分。</p> <h4 id="非tabbar页面"><a href="#非tabbar页面" class="header-anchor">#</a> 非tabBar页面</h4> <ol><li>使用wx.navigateTo和组件 <code>&lt;navigator open-type=&quot;navigateTo&quot;/&gt;</code>打开页面，会将要打开的这个页面加入页面栈。注意：不管这个页面当前在不在页面栈 。</li> <li>页面从页面栈中移除会触发被移除页面的 Unload 事件。</li> <li>将页面加入页面栈中，这会触发这个页面的Load事件。</li> <li>页面重定向和页面返回也将离开的页面移除页面栈。</li> <li>页面返回是从页面栈的pop，如果页面栈的长度为1，执行页面返回操作，是没有效果的</li></ol> <h4 id="tabbar页面"><a href="#tabbar页面" class="header-anchor">#</a> tabBar页面</h4> <p>tabBar页面与其他页面有所不同，所有与其他页面分开总结</p> <ol><li>打开tabBar页面，其他页面全部出栈，只在页面栈中留下当前tabBar页面。</li> <li>第一次打开tabBar页面，会触发这个页面的Load事件。</li> <li>在tabBar页面执行重定向操作进入另一个页面，这会触发tabBar页面的Unload事件。下一次再进入这个tabBar页面会触发Load事件。</li> <li>要打开tabBar页面只能调用 wx.switchTab,wx.reLaunch或使用组件 <navigator open-type="switchTab"></navigator></li></ol> <p>调用 wx.reLaunch 或者 使用组件 <navigator open-type="reLaunch"></navigator>重启动会将所有页面Unload。</p> <h3 id="运行机制"><a href="#运行机制" class="header-anchor">#</a> 运行机制</h3> <ol><li>小程序有两种启动情况，分别是<code>热启动</code>和<code>冷启动</code>。</li></ol> <ul><li>冷启动: 用户首次访问小程序，小程序被微信主动销毁或者将小程序从最近使用列表中删除，在以上三种情况打开小程序，小程序会冷启动。小程序冷启动会触发App实例的Launch事件，冷启动不会清除授权数据和Storage中的数据。</li> <li>热启动: 将小程序从后台切换到前台。比如用户已经打开过小程序，在将来的一段事件内再次打开小程序，在这种情况无须重新启动小程序，这个过程是热启动。</li></ul> <p>2.微信小程序被销毁：</p> <ul><li>小程序进入后台超过一段时间，小程序会被微信主动销毁</li> <li>小程序占用的系统资源过高，会被系统销毁或者被微信客户端回收，在ios中尤为严格。
建议使用 <code>wx.onMemoryWarning(function callback)</code> 监听内存不足事件，在收到通知后回收一些不必要资源避免进一步加剧内存紧张。后续会提到性能优化的相关内容。</li></ul> <ol start="3"><li>微信小程序的逻辑层和视图层由两个线程分开管理。视图层的界面使用了WebView 进行渲染，由于小程序中存在多个页面，所以视图层存在多个webview线程，但是只存在一个逻辑层线程，WXML 模板和 WXSS 样式工作在视图层，JS 脚本工作在逻辑层。
<img src="/assets/img/construct.ad156d1c.png" alt="逻辑层与视图层"></li></ol> <blockquote><p>由于多个视图层进程共用一个逻辑层进程，会不会存在视图层之间抢占资源的情况？如果在A页面启动了一个定时器，然后又进入B页面，由于A页面并不会被卸载，一定时间后A页面中的定时器回调函数会不会与抢占B页面抢占资源？</p></blockquote> <p>逻辑层和视图层进行通信需要通过微信客户端做中转，逻辑层修改了数据想要更新视图，只能调用<code>setData</code>方法，而且调用之后视图并不会立即更新，更新是异步完成的。调用<code>setData</code>方法的结果是：修改data中的数据(同步)，更新视图(异步)。调用<code>setData</code>会引起视图层和逻辑层的数据传输，频繁的调用这个方法会存在性能问题。</p> <h3 id="版本更新"><a href="#版本更新" class="header-anchor">#</a> 版本更新</h3> <p>小程序审核通过之后就可以将小程序发布到线上供线上用户使用。下面介绍小程序发布到线上之后，小程序的更新机制。</p> <blockquote><p>微信客户端会自动的检查本地缓冲的小程序是否有新的版本，如果有新的版本，就会异步下载，等下一次再使用新的版本</p></blockquote> <p>如果需要用户马上使用新版本，可以在App的Launch事件中使用<code>wx.getUpdateManager</code>检查新版本。详细内容请查看<a href="https://developers.weixin.qq.com/community/develop/doc/000c2430d30b70251e86f0a0256c09" target="_blank" rel="noopener noreferrer">小程序官方提供的文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h3> <h4 id="setdata"><a href="#setdata" class="header-anchor">#</a> setData</h4> <p>在<a href="#%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6">运行机制</a>一节中已经提到<code>setData</code>的作用，在小程序中使用最频繁的接口就是<code>setData</code>，调用<code>setData</code>方法会引起逻辑层和视图层间的数据传输。实际上通过两边提供的 evaluateJavascript 所实现。即用户传输的数据，需要将其转换为字符串形式传递，同时把转换后的数据内容拼接成一份 JS 脚本，再通过执行 JS 脚本的形式传递到两边独立环境，而 evaluateJavascript 的执行会受很多方面的影响，数据到达视图层并不是实时的。
常见的 setData 操作错误</p> <ol><li>频繁的调用<code>setData</code></li></ol> <ul><li>Android 下用户在滑动时会感觉到卡顿，操作反馈延迟严重，因为 JS 线程一直在编译执行渲染，未能及时将用户操作事件传递到逻辑层，逻辑层亦无法及时将操作处理结果及时传递到视图层；</li> <li>渲染有出现延时，由于 WebView 的 JS 线程一直处于忙碌状态，逻辑层到页面层的通信耗时上升，视图层收到的数据消息时距离发出时间已经过去了几百毫秒，渲染的结果并不实时；</li></ul> <blockquote><p>建议：对连续的setData进行合并</p></blockquote> <ol start="2"><li>调用<code>setData</code>在逻辑层与视图层数据传输实际是一次 evaluateJavascript 脚本过程，当数据量过大时会增加脚本的编译执行时间，会占用 WebView JS 线程，这个时候WebView Js线程就不能处理其他的脚本，这会造成卡顿。</li></ol> <blockquote><p>建议：只将与页面渲染相关的数据放在data中，使用setData去改变data中的数据。例如：有数据A，数据B，通过A和B计算得到数据C，数据C与界面，那么只将C放在data中。</p></blockquote> <ol start="3"><li>后台页面进行setData
当页面进入后台态（用户不可见），不应该继续去进行setData，后台态页面的渲染用户是无法感受的，另外后台态页面去setData也会抢占前台页面的执行。</li></ol> <h4 id="图片资源"><a href="#图片资源" class="header-anchor">#</a> 图片资源</h4> <p>图片资源的主要性能问题在于大图片和长列表图片上，这两种情况都有可能导致 iOS 客户端内存占用上升，从而触发系统回收小程序页面。</p> <blockquote><p>建议：减少使用大图片，对图片进行压缩，分页展示长列表图片。</p></blockquote> <h4 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h4> <ol><li>onPageScroll:
在不需要监听页面滚动，就不要在page中定义这个方法，如果非要监听页面滚动，就避免在回调函数中执行setData，建议节流。</li> <li>事件绑定时需要传输target和currentTarget的dataset，因而不要在节点的data前缀属性中放置过大的数据。</li></ol> <h4 id="代码包大小"><a href="#代码包大小" class="header-anchor">#</a> 代码包大小</h4> <p>微信客户端在打开小程序之前，会把整个小程序的代码包下载到本地，代码包大小直接影响到下载速度，从而影响用户的首次打开体验。从以下几方面减少代码包的大小：</p> <ol><li>将图片，视频，音频等体积较大的媒体文件移至服务器，需要时再下载。</li> <li>将固定的数据，如配置，城市地区等大段数据，保持到服务器，在需要的时候调用接口获得。</li> <li>删掉废弃的代码，封装组件或者<code>&lt;template/&gt;</code>，封装函数，提取公共样式避免重复代码。</li> <li>将整个小程序的代码根据功能或者模块分成不同的代码包。在这儿可以查看<a href="#%E5%88%86%E5%8C%85">分包</a>的具体内容</li></ol> <h3 id="分包加载"><a href="#分包加载" class="header-anchor">#</a> 分包加载</h3> <blockquote><p>将小程序分成不同的子包，在用户需要使用的时候按需进行加载，这样可以优化小程序首次启动的下载时间。</p></blockquote> <p>每一个分包小程序都必定会有一个主包，在主包中会放默认启动页面/TabBar 页面(必须)，以及一些所有分包都需用到公共资源/JS 脚本(非必须)；而分包则是根据开发者的配置进行划分。在小程序启动时，默认会下载主包并启动主页面，当用户进入分包内某个页面时，客户端会把对应分包下载下来，下载完成后再进行展示。
小程序分包大小限制：</p> <ol><li>整个小程序所以分包大小不超过8M</li> <li>单个分包/主包大小不超过2M</li></ol> <h4 id="配置分包"><a href="#配置分包" class="header-anchor">#</a> 配置分包</h4> <p>在app.json 中subpackages字段中声明项目分包结构。以接龙圈为例：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>    <span class="token punctuation">{</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;pages/index/index&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;pages/common/pages/common/common&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;pages/common/pages/verification/verification&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;pages/common/pages/ordersign/ordersign&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;pages/common/pages/login/index&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/create-jl&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;pages/jl-reset/index&quot;</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pages/home&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;pages/supply-introduce/index&quot;</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>subpackages字段是一个数组，在subpackages字段中声明分包，分包的个数不限，每个分包有如下配置：</p> <ol><li>root: 分包根目录</li> <li>pages: 分包页面路径，相对于分包根目录</li> <li>name: 分包别名，在分包预加载的时候使用，欲知<a href="#%E5%88%86%E5%8C%85%E9%A2%84%E5%8A%A0%E8%BD%BD">分包预加载</a>的内容见下文</li> <li>independent: 是否是独立分包，欲知<a href="#%E7%8B%AC%E7%AB%8B%E5%88%86%E5%8C%85">独立分包</a>的内容见下文</li></ol> <h4 id="打包原则"><a href="#打包原则" class="header-anchor">#</a> 打包原则</h4> <ol><li>声明 subpackages 后，将按 subpackages 配置路径进行打包，subpackages 配置路径外的目录将被打包到 app（主包）中</li> <li>各个分包是独立的，app.json 中 subpackages字段定义的各个分包的文件不能交叉，即分包A不能引用分包B中的文件，subpackage 的根目录不能是另外一个 subpackage 内的子目录。</li> <li>tabBar 页面必须在 app（主包）内</li> <li>一个页面要么在主包中，要么在某个分包中。</li> <li>分包A不能使用分包B中的文件，只能使用主包或者自己包中的文件</li></ol> <blockquote><p>如果主包分包划分不好，主包的大小也很难降下来，所以如何分包相对比较复杂。在一个项目开发过程中，代码的分包可能不是一成不变的，例如随着业务复杂度上升，原本在分包A中的页面，要独立成另外一个分包B，如果用户访问了以前的page则得不到正确的页面响应（例如：分享出去的小程序卡片等），这种情况要兼容处理。</p></blockquote> <h4 id="独立分包"><a href="#独立分包" class="header-anchor">#</a> 独立分包</h4> <p>独立分包是小程序中一种特殊类型的分包，可以独立于主包和其他分包运行，一个小程序可以有多个独立分包。从独立分包中页面进入小程序时，不需要下载主包。当用户进入普通分包或主包内页面时，主包才会被下载。
独立分包注意事项：</p> <ol><li>独立分包属于分包的一种。普通分包的所有限制都对独立分包有效</li> <li>独立分包不能依赖主包中的js文件，template、wxss、自定义组件、插件等。主包中的app.wxss对独立包无效</li> <li>独立分包运行时，<code>App</code> 不一定被注册了，因此 <code>getApp()</code> 也不一定可以获得 App 对象,因此在独立包中无法通过App对象实现全局数据共享。</li> <li>从独立分包启动小程序，主包中 App 的 onLaunch 和首次 onShow不会被调用。只要从独立分包首次进入主包或者其他普通分包中的页面时才会被调用。</li></ol> <blockquote><p>个人认为可以将一些推广页或者活动页放在独立分包中，打开独立分包中的页面不需要下载主包，所以可以快速打开，但是独立分包中不建议写复杂的业务</p></blockquote> <p>从基础库 2.2.4 版本开始 getApp支持 <code>allowDefault</code>参数，在 App 未定义时返回一个默认实现。当主包加载，App 被注册时，默认实现中定义的属性会被覆盖合并到真正的 App 中。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// 独立分包中</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>allowDefault<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// {}</span>
    app<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token number">456</span>
    app<span class="token punctuation">.</span>global <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">// App.js中</span>
    <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>
      other<span class="token operator">:</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// {global: {}, data: 456, other: 'hello'}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="分包预加载"><a href="#分包预加载" class="header-anchor">#</a> 分包预加载</h4> <p>开发者可以通过配置，在进入小程序某个页面时，由框架自动预下载可能需要的分包，提升进入后续分包页面时的启动速度。对于独立分包，也可以预下载主包。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pages/index&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;subpackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;important&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub1&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;path/to&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;root&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sub3&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;pages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;preloadRule&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pages/index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;important&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sub1/index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sub3&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sub3/index&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;path/to&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="文件系统"><a href="#文件系统" class="header-anchor">#</a> 文件系统</h3> <p>小程序以微信客户端作为中转，被赋予了读写某些权限的能力。所有文件的管理操作，如：复制，写入等都需要通过<code>FileSystemManager</code>来调用。通过 <code>wx.getFileSystemManager()</code> 可以获取到全局唯一的文件系统管理器。详情可查看<a href="https://developers.weixin.qq.com/miniprogram/dev/api/file/FileSystemManager.html" target="_blank" rel="noopener noreferrer">api文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token keyword">const</span> fs <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getFileSystemManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在微信小程序中文件分为两大类
1.代码包文件： 在项目目录中添加的文件，如图片,js,json等
2.本地文件：通过调用接口本地产生，或通过网络下载下来，存储到本地的文件。如调用<code>wx.downloadFile()</code>,<code>wx.chooseImage()</code>等</p> <p>在这节内容主要介绍本地文件，本地文件分为三种：本地临时文件，本地缓存文件和本地用户文件。本地文件是从用户和小程序两个纬度进行隔离。</p> <ol><li>本地临时文件：临时产生，随时会被回收的文件,不限制存储大小。本地临时文件只保证在小程序当前生命周期内可用，一旦小程序被关闭就可能被清理，即下次冷启动不保证可用。<em>不可把本地临时文件路径存储起来下次使用</em>。在小程序中能够产生临时文件的接口有很多，如<code>wx.chooseImage</code>,<code>wx.chooseVideo</code>以及<code>wx.compressImage</code>等。</li> <li>本地缓存文件：通过接口将临时文件缓存后产生的文件。调用<code>FileSystemManager.saveFile()</code>将临时文件转成缓存文件，缓存文件在重启之后仍可用。</li> <li>本地用户文件：本地用户文件是从 1.7.0 版本开始新增的概念。我们提供了一个用户文件目录给开发者，开发者对这个目录有完全自由的读写权限。通过 wx.env.USER_DATA_PATH 可以获取到这个目录的路径。</li></ol> <blockquote><p>本地缓存文件和本地用户文件的清理时机跟代码包一样，只有在代码包被清理的时会被清理，数据缓存也会在代码包被清理的时候被清理，所以不用的缓冲请及时清理。问题：代码包什么时候被清理呢？</p></blockquote> <h3 id="授权"><a href="#授权" class="header-anchor">#</a> 授权</h3> <p>某些接口需要用户授权才能调用，只有接受授权才能调用。调用需要授权的接口存在如下的情况：</p> <ul><li>如果用户未接受或拒绝过此权限，会弹窗询问用户，用户点击同意后方可调用接口；</li> <li>如果用户已授权，可以直接调用接口；</li> <li>如果用户已拒绝授权，则不会出现弹窗，而是直接进入接口 fail 回调。</li></ul> <h4 id="授权有效期"><a href="#授权有效期" class="header-anchor">#</a> 授权有效期</h4> <p>一旦用户明确同意或拒绝过授权，其授权关系会记录在后台，直到用户主动删除小程序。</p> <h4 id="提前发起授权请求"><a href="#提前发起授权请求" class="header-anchor">#</a> 提前发起授权请求</h4> <p>开发者可以使用 <code>wx.authorize</code> 在调用需授权 API 之前，提前向用户发起授权请求。不推荐这样做，推荐的做法是在真正需要使用授权接口时，才向用户发起授权申请，并在授权申请中说明清楚要使用该功能的理由。</p> <blockquote><p>授权 <code>scope.userLocation</code> 时必须配置地理位置用途说明。在app.json 的permission字段中配置</p></blockquote> <h4 id="需要授权的scope列表"><a href="#需要授权的scope列表" class="header-anchor">#</a> 需要授权的scope列表</h4> <table><thead><tr><th style="text-align:left;">scope</th> <th>接口</th> <th style="text-align:right;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">scope.userInfo</td> <td>wx.getUserInfo</td> <td style="text-align:right;">用户信息</td></tr> <tr><td style="text-align:left;">scope.userLocation</td> <td>wx.getLocation, wx.chooseLocation</td> <td style="text-align:right;">地理位置</td></tr> <tr><td style="text-align:left;">scope.address</td> <td>wx.chooseAddress</td> <td style="text-align:right;">通讯地址</td></tr> <tr><td style="text-align:left;">scope.invoiceTitle</td> <td>wx.chooseInvoiceTitle</td> <td style="text-align:right;">发票抬头</td></tr> <tr><td style="text-align:left;">scope.invoice</td> <td>wx.chooseInvoice</td> <td style="text-align:right;">获取发票</td></tr> <tr><td style="text-align:left;">scope.werun</td> <td>wx.getWeRunData</td> <td style="text-align:right;">微信运动步数</td></tr> <tr><td style="text-align:left;">scope.record</td> <td>wx.startRecord</td> <td style="text-align:right;">录音功能</td></tr> <tr><td style="text-align:left;">scope.writePhotosAlbum</td> <td>wx.saveImageToPhotosAlbum, wx.saveVideoToPhotosAlbum</td> <td style="text-align:right;">保存到相册</td></tr> <tr><td style="text-align:left;">scope.camera</td> <td>camera 组件</td> <td style="text-align:right;">摄像头</td></tr></tbody></table> <p>使用<code>wx.authorize</code>想用户发起授权</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    wx<span class="token punctuation">.</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token string">'scope.address'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>wx.authorize({scope: &quot;scope.userInfo&quot;})，不会弹出授权窗口，请使用 <code>&lt;button open-type=&quot;getUserInfo&quot;/&gt;</code></p></blockquote> <h4 id="获取用户授权信息"><a href="#获取用户授权信息" class="header-anchor">#</a> 获取用户授权信息</h4> <p>使用 wx.getSetting 获取用户当前的授权状态。如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    wx<span class="token punctuation">.</span><span class="token function">getSetting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 如果已接受获取用户信息授权</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>authSetting<span class="token punctuation">[</span><span class="token string">'scope.userInfo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// toSomething</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="打开权限设置界面"><a href="#打开权限设置界面" class="header-anchor">#</a> 打开权限设置界面</h4> <div class="language-html line-numbers-mode"><pre class="language-html"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openSetting<span class="token punctuation">&quot;</span></span> <span class="token attr-name">bindopensetting</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>callback<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>打开设置页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    或者
    
    <span class="token comment">&lt;!--基础库在2.2.4及以上支持--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openSetting<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>打开设置页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  openSetting() {  wx.openSetting()}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>在基础库 2.3.0以下版本可以直接调用<code>wx.openSetting</code>接口打开授权界面</p></blockquote> <h3 id="低版本兼容"><a href="#低版本兼容" class="header-anchor">#</a> 低版本兼容</h3> <p>在小程序中会存在旧版本的基础库不支持新功能的情况，了解自己小程序最低要兼容的基础库版本是很有必要的。在小程序管理后台可设置小程序最低基础库版本，并且在开发者工具中也能设置调试基本库的版本。在用户访问小程序时，如果用户基础库版本低于设置值，则无法正常打开小程序，并提示用户更新客户端版本。</p> <h4 id="兼容方案"><a href="#兼容方案" class="header-anchor">#</a> 兼容方案</h4> <p>1.版本号比较
在开发文档中会在组件，API等页面描述中带上各个功能所要求的最低基础库版本号，通过<code>wx.getSystemInfo</code>可以获取到当前小程序运行的基础库的版本号。</p> <blockquote><p>版本号比较适用于所有情况</p></blockquote> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token parameter">v1<span class="token punctuation">,</span> v2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  v1 <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  v2 <span class="token operator">=</span> v2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>v2<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>num1 <span class="token operator">&gt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>num1 <span class="token operator">&lt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> version <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SDKVersion

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareVersion</span><span class="token punctuation">(</span>version<span class="token punctuation">,</span> <span class="token string">'1.1.0'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wx<span class="token punctuation">.</span><span class="token function">openBluetoothAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示</span>
  wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><ol start="2"><li>API 存在判断
对于新增的 API，可以通过判断该API是否存在来判断是否支持用户使用的基础库版本。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>wx<span class="token punctuation">.</span>openBluetoothAdapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wx<span class="token punctuation">.</span><span class="token function">openBluetoothAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果希望用户在最新版本的客户端上体验您的小程序，可以这样子提示</span>
  wx<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li>wx.canIUse
<code>wx.canIUse</code>返回布尔值，如果能够使用就返回true，不能使用false。<a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/wx.canIUse.html" target="_blank" rel="noopener noreferrer">wx.canIUse的具体用法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
wx.canIUse 使用 ${API}.${method}.${param}.${option} 或者 ${component}.${attribute}.${option} 方式来调用。</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>    <span class="token comment">// 能否使用cover-image组件</span>
    wx<span class="token punctuation">.</span><span class="token function">canIUse</span><span class="token punctuation">(</span><span class="token string">&quot;cover-image&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// cover-image组件是否支持bindload属性</span>
    wx<span class="token punctuation">.</span><span class="token function">canIUse</span><span class="token punctuation">(</span><span class="token string">&quot;cover-image.bindload&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// wx.showToast的参数是否支持image属性</span>
    wx<span class="token punctuation">.</span><span class="token function">canIUse</span><span class="token punctuation">(</span><span class="token string">'showToast.object.image'</span><span class="token punctuation">)</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><!----> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">February 11, 2020 11:31</span></div> <div class="meta-item contributors"><span class="label">Contributors: </span> <span class="info"><span title="email: 1395294694@qq.com" class="contributor">
          何遇
        </span> <!----></span></div></footer> <!----> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.9dc39beb.js" defer></script><script src="/assets/js/vendors~layout-Layout.ed0c22da.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.63b68437.js" defer></script><script src="/assets/js/page-微信小程序学习笔记.d3722e3c.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.238c3454.js" defer></script>
  </body>
</html>
